name: Deploy with validation on feature push

on:
    push:
        branches:
            - 'force-app/**'     
jobs:
    build:
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v2
              with:
                  ref: ${{ github.ref }}
                  fetch-depth: 0
              if: github.event_name == 'push'
            - uses: actions/setup-node@v1
              with:
                  node-version: '>=14'
            - name: Install Salesforce CLI
              run: |
                  wget https://developer.salesforce.com/media/salesforce-cli/sfdx-linux-amd64.tar.xz
                  mkdir sfdx-cli
                  tar xJf sfdx-linux-amd64.tar.xz -C sfdx-cli --strip-components 1
                  ./sfdx-cli/install
            - name: 'Populate auth file with SFDX_URL secret'
              shell: bash
              run: 'echo ${{ secrets.YOURPLACESPROD }} > SFDX_Q'
 
            - name: 'Authenticate to Production Org'
              run: sfdx auth:sfdxurl:store -f SFDX_Q
      
            - name: 'Run checkonly deploy'
              run: sfdx force:source:deploy -x manifest/package.xml -u fastusername@com.pl --testlevel RunLocalTests --json --checkonly